"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[4875],{74875:(e,t,i)=>{i.r(t),i.d(t,{ABCWidgetFactory:()=>w,Base64ModelFactory:()=>F,Context:()=>m,DocumentModel:()=>y,DocumentRegistry:()=>E,DocumentWidget:()=>b,MimeContent:()=>T,MimeDocument:()=>O,MimeDocumentFactory:()=>D,TextModelFactory:()=>f});var s=i(37782),a=i(59110);class n{constructor(){this._isDisposed=!1}get isDisposed(){return this._isDisposed}get ready(){return Promise.resolve()}dispose(){this.isDisposed||(this._isDisposed=!0)}}var o,r=i(12299),h=i(56956),l=i(92233),d=i(36e3),c=i(4947),_=i(42051);class m{constructor(e){this._path="",this._lineEnding=null,this._contentsModel=null,this._populatedPromise=new l.PromiseDelegate,this._isPopulated=!1,this._isReady=!1,this._isDisposed=!1,this._pathChanged=new c.Signal(this),this._fileChanged=new c.Signal(this),this._saveState=new c.Signal(this),this._disposed=new c.Signal(this),this._lastModifiedCheckMargin=500,this._timeConflictModalIsOpen=!1;const t=this._manager=e.manager;this.translator=e.translator||h.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._factory=e.factory,this._dialogs=e.sessionDialogs||s.sessionContextDialogs,this._opener=e.opener||o.noOp,this._path=this._manager.contents.normalize(e.path),this._lastModifiedCheckMargin=e.lastModifiedCheckMargin||500;const i=this._manager.contents.localPath(this._path),d=this._factory.preferredLanguage(a.PathExt.basename(i)),_=e.modelDBFactory;if(_){const e=t.contents.localPath(this._path);this._modelDB=_.createNew(e),this._model=this._factory.createNew(d,this._modelDB,!1,"true"===a.PageConfig.getOption("collaborative"))}else this._model=this._factory.createNew(d,void 0,!1,"true"===a.PageConfig.getOption("collaborative"));const m=e.docProviderFactory;this._provider=m?m({path:this._path,contentType:this._factory.contentType,format:this._factory.fileFormat,model:this._model.sharedModel,collaborative:this._model.collaborative}):new n,this._readyPromise=t.ready.then((()=>this._populatedPromise.promise));const g=a.PathExt.extname(this._path);this.sessionContext=new s.SessionContext({sessionManager:t.sessions,specsManager:t.kernelspecs,path:this._path,type:".ipynb"===g?"notebook":"file",name:a.PathExt.basename(i),kernelPreference:e.kernelPreference||{shouldStart:!1},setBusy:e.setBusy}),this.sessionContext.propertyChanged.connect(this._onSessionChanged,this),t.contents.fileChanged.connect(this._onFileChanged,this),this.urlResolver=new r.RenderMimeRegistry.UrlResolver({path:this._path,contents:t.contents}),this.model.sharedModel.changed.connect(this.onStateChanged,this)}get pathChanged(){return this._pathChanged}get fileChanged(){return this._fileChanged}get saveState(){return this._saveState}get disposed(){return this._disposed}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){this._lastModifiedCheckMargin=e}get model(){return this._model}get path(){return this._path}get localPath(){return this._manager.contents.localPath(this._path)}get contentsModel(){return this._contentsModel}get factoryName(){return this.isDisposed?"":this._factory.name}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this.sessionContext.dispose(),this._modelDB&&this._modelDB.dispose(),this._model.dispose(),this._provider.dispose(),this._model.sharedModel.dispose(),this._disposed.emit(void 0),c.Signal.clearData(this))}get isReady(){return this._isReady}get ready(){return this._readyPromise}get canSave(){var e;return!(!(null===(e=this._contentsModel)||void 0===e?void 0:e.writable)||this._model.collaborative)}async initialize(e){this._model.collaborative?await this._loadContext():(e?await this._save():await this._revert(),this._model.initialize()),this.model.sharedModel.clearUndoHistory()}rename(e){return this.ready.then((()=>this._manager.ready.then((()=>this._rename(e)))))}async save(){await this.ready,await this._save()}async saveAs(){await this.ready;const e=this._manager.contents.localPath(this.path),t=await o.getSavePath(e);if(this.isDisposed||!t)return;const i=this._manager.contents.driveName(this.path),s=""==i?t:`${i}:${t}`;if(s===this._path)return this.save();try{await this._manager.ready,await this._manager.contents.get(s),await this._maybeOverWrite(s)}catch(e){if(!e.response||404!==e.response.status)throw e;await this._finishSaveAs(s)}}async download(){const e=await this._manager.contents.getDownloadUrl(this._path),t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}async revert(){await this.ready,await this._revert()}createCheckpoint(){const e=this._manager.contents;return this._manager.ready.then((()=>e.createCheckpoint(this._path)))}deleteCheckpoint(e){const t=this._manager.contents;return this._manager.ready.then((()=>t.deleteCheckpoint(this._path,e)))}restoreCheckpoint(e){const t=this._manager.contents,i=this._path;return this._manager.ready.then((()=>e?t.restoreCheckpoint(i,e):this.listCheckpoints().then((s=>{if(!this.isDisposed&&s.length)return e=s[s.length-1].id,t.restoreCheckpoint(i,e)}))))}listCheckpoints(){const e=this._manager.contents;return this._manager.ready.then((()=>e.listCheckpoints(this._path)))}addSibling(e,t={}){const i=this._opener;return i&&i(e,t),new d.DisposableDelegate((()=>{e.close()}))}onStateChanged(e,t){t.stateChange&&t.stateChange.forEach((e=>{var t,i;if("path"===e.name){const s=this._manager.contents.driveName(this._path);let n=e.newValue;if(s&&(n=`${s}:${e.newValue}`),this._path!==n){this._path=n;const e=this._manager.contents.localPath(n),s=a.PathExt.basename(e);if(null===(t=this.sessionContext.session)||void 0===t||t.setPath(n),null===(i=this.sessionContext.session)||void 0===i||i.setName(s),this.urlResolver.path=n,this._contentsModel){const e=Object.assign(Object.assign({},this._contentsModel),{name:s,path:n});this._updateContentsModel(e)}this._pathChanged.emit(n)}}}))}_onFileChanged(e,t){var i,s,n;if("rename"!==t.type)return;let o=t.oldValue&&t.oldValue.path,r=t.newValue&&t.newValue.path;if(r&&0===this._path.indexOf(o||"")){let e=t.newValue;o!==this._path&&(r=this._path.replace(new RegExp(`^${o}/`),`${r}/`),o=this._path,e={last_modified:null===(i=t.newValue)||void 0===i?void 0:i.created,path:r}),this._path=r;const h=Object.assign(Object.assign({},this._contentsModel),e),l=this._manager.contents.localPath(r);null===(s=this.sessionContext.session)||void 0===s||s.setPath(r),null===(n=this.sessionContext.session)||void 0===n||n.setName(a.PathExt.basename(l)),this.urlResolver.path=r,this._updateContentsModel(h),this._model.sharedModel.setState("path",l),this._pathChanged.emit(r)}}_onSessionChanged(e,t){if("path"!==t)return;const i=this.sessionContext.session.path;if(i!==this._path){this._path=i;const e=this._manager.contents.localPath(i),t=a.PathExt.basename(e);if(this.urlResolver.path=i,this._contentsModel){const e=Object.assign(Object.assign({},this._contentsModel),{name:t,path:i});this._updateContentsModel(e)}this._model.sharedModel.setState("path",e),this._pathChanged.emit(i)}}_updateContentsModel(e){const t=e.writable&&!this._model.collaborative,i={path:e.path,name:e.name,type:e.type,content:void 0,writable:t,created:e.created,last_modified:e.last_modified,mimetype:e.mimetype,format:e.format},s=this._contentsModel?this._contentsModel.last_modified:null;this._contentsModel=i,this._model.sharedModel.setState("last_modified",i.last_modified),s&&i.last_modified===s||this._fileChanged.emit(i)}async _populate(){if(await this._provider.ready,this._isPopulated=!0,this._isReady=!0,this._populatedPromise.resolve(void 0),await this._maybeCheckpoint(!1),this.isDisposed)return;const e=this._model.defaultKernelName||this.sessionContext.kernelPreference.name;this.sessionContext.kernelPreference=Object.assign(Object.assign({},this.sessionContext.kernelPreference),{name:e,language:this._model.defaultKernelLanguage}),this.sessionContext.initialize().then((e=>{e&&this._dialogs.selectKernel(this.sessionContext,this.translator)}))}async _rename(e){var t,i;const s=this.localPath.split("/");s[s.length-1]=e;let n=a.PathExt.join(...s);const o=this._manager.contents.driveName(this.path);o&&(n=`${o}:${n}`),await this._manager.contents.rename(this.path,n),await(null===(t=this.sessionContext.session)||void 0===t?void 0:t.setPath(n)),await(null===(i=this.sessionContext.session)||void 0===i?void 0:i.setName(e)),this._path=n;const r=this._manager.contents.localPath(this._path);this.urlResolver.path=n,this._model.sharedModel.setState("path",r),this._pathChanged.emit(n)}async _save(){if(this._model.collaborative)return;this._saveState.emit("started");const e=this._createSaveOptions();try{let t;if(await this._manager.ready,t=await this._maybeSave(e),this.isDisposed)return;this._model.dirty=!1,this._updateContentsModel(t),this._isPopulated||await this._populate(),this._saveState.emit("completed")}catch(e){if("Cancel"===e.message||"Modal is already displayed"===e.message)throw e;const t=this._manager.contents.localPath(this._path),i=a.PathExt.basename(t);throw this._handleError(e,this._trans.__("File Save Error for %1",i)),this._saveState.emit("failed"),e}}_loadContext(){const e=Object.assign({type:this._factory.contentType,content:!1},null!==this._factory.fileFormat?{format:this._factory.fileFormat}:{}),t=this._path;return this._manager.ready.then((()=>this._manager.contents.get(t,e))).then((e=>{if(this.isDisposed)return;const t=Object.assign(Object.assign({},e),{format:this._factory.fileFormat});return this._updateContentsModel(t),this._model.dirty=!1,this._isPopulated?void 0:this._populate()})).catch((async e=>{const t=this._manager.contents.localPath(this._path),i=a.PathExt.basename(t);throw this._handleError(e,this._trans.__("File Load Error for %1",i)),e}))}_revert(e=!1){const t=Object.assign({type:this._factory.contentType,content:null!==this._factory.fileFormat},null!==this._factory.fileFormat?{format:this._factory.fileFormat}:{}),i=this._path,s=this._model;return this._manager.ready.then((()=>this._manager.contents.get(i,t))).then((e=>{if(!this.isDisposed){if("json"===e.format)s.fromJSON(e.content);else{let t=e.content;-1!==t.indexOf("\r\n")?(this._lineEnding="\r\n",t=t.replace(/\r\n/g,"\n")):-1!==t.indexOf("\r")?(this._lineEnding="\r",t=t.replace(/\r/g,"\n")):this._lineEnding=null,s.fromString(t)}return this._updateContentsModel(e),s.dirty=!1,this._isPopulated?void 0:this._populate()}})).catch((async e=>{const t=this._manager.contents.localPath(this._path),i=a.PathExt.basename(t);throw this._handleError(e,this._trans.__("File Load Error for %1",i)),e}))}_maybeSave(e){const t=this._path;return this._manager.contents.get(t,{content:!1}).then((i=>{var s;if(this.isDisposed)return Promise.reject(new Error("Disposed"));const a=this._lastModifiedCheckMargin,n=this._model.sharedModel.getState("last_modified")||(null===(s=this.contentsModel)||void 0===s?void 0:s.last_modified),o=n?new Date(n):new Date,r=new Date(i.last_modified);return n&&r.getTime()-o.getTime()>a?this._timeConflict(o,i,e):this._manager.contents.save(t,e)}),(i=>{if(i.response&&404===i.response.status)return this._manager.contents.save(t,e);throw i}))}async _handleError(e,t){await(0,s.showErrorMessage)(t,e)}_maybeCheckpoint(e){let t=Promise.resolve(void 0);return this.canSave?(t=e?this.createCheckpoint().then():this.listCheckpoints().then((e=>{if(!this.isDisposed&&!e.length&&this.canSave)return this.createCheckpoint().then()})),t.catch((e=>{if(!e.response||403!==e.response.status)throw e}))):t}_timeConflict(e,t,i){const a=new Date(t.last_modified);if(console.warn(`Last saving performed ${e} while the current file seems to have been saved ${a}`),this._timeConflictModalIsOpen)return Promise.reject(new Error("Modal is already displayed"));const n=this._trans.__('"%1" has changed on disk since the last time it was opened or saved.\nDo you want to overwrite the file on disk with the version open here,\nor load the version on disk (revert)?',this.path),o=s.Dialog.okButton({label:this._trans.__("Revert")}),r=s.Dialog.warnButton({label:this._trans.__("Overwrite")});return this._timeConflictModalIsOpen=!0,(0,s.showDialog)({title:this._trans.__("File Changed"),body:n,buttons:[s.Dialog.cancelButton(),o,r]}).then((e=>(this._timeConflictModalIsOpen=!1,this.isDisposed?Promise.reject(new Error("Disposed")):e.button.label===this._trans.__("Overwrite")?this._manager.contents.save(this._path,i):e.button.label===this._trans.__("Revert")?this.revert().then((()=>t)):Promise.reject(new Error("Cancel")))))}_maybeOverWrite(e){const t=this._trans.__('"%1" already exists. Do you want to replace it?',e),i=s.Dialog.warnButton({label:this._trans.__("Overwrite")});return(0,s.showDialog)({title:this._trans.__("File Overwrite?"),body:t,buttons:[s.Dialog.cancelButton(),i]}).then((t=>this.isDisposed?Promise.reject(new Error("Disposed")):t.button.label===this._trans.__("Overwrite")?this._manager.contents.delete(e).then((()=>this._finishSaveAs(e))):void 0))}async _finishSaveAs(e){this._saveState.emit("started");try{await this._manager.ready;const t=this._createSaveOptions();await this._manager.contents.save(e,t),await this._maybeCheckpoint(!0),this._saveState.emit("completed")}catch(e){if("Cancel"===e.message||"Modal is already displayed"===e.message)throw e;const t=this._manager.contents.localPath(this._path),i=a.PathExt.basename(t);return this._handleError(e,this._trans.__("File Save Error for %1",i)),void this._saveState.emit("failed")}}_createSaveOptions(){let e=null;return"json"===this._factory.fileFormat?e=this._model.toJSON():(e=this._model.toString(),this._lineEnding&&(e=e.replace(/\n/g,this._lineEnding))),{type:this._factory.contentType,format:this._factory.fileFormat,content:e}}}!function(e){e.getSavePath=function(e,i){const a=(i=i||h.nullTranslator).load("jupyterlab"),n=s.Dialog.okButton({label:a.__("Save")});return(0,s.showDialog)({title:a.__("Save File As.."),body:new t(e),buttons:[s.Dialog.cancelButton(),n]}).then((e=>{var t;if(e.button.label===a.__("Save"))return null!==(t=e.value)&&void 0!==t?t:void 0}))},e.noOp=function(){};class t extends _.Widget{constructor(e){super({node:i(e)})}getValue(){return this.node.value}}function i(e){const t=document.createElement("input");return t.value=e,t}}(o||(o={}));var g=i(42938),p=i(79112),u=i(20156);class y extends g.p.Model{constructor(e,t,i){super({modelDB:t}),this._defaultLang="",this._dirty=!1,this._readOnly=!1,this._contentChanged=new c.Signal(this),this._stateChanged=new c.Signal(this),this._defaultLang=e||"";const s=new u.QM;this.switchSharedModel(s,!0),this.value.changed.connect(this.triggerContentChange,this),this.sharedModel.changed.connect(this._onStateChanged,this),this._collaborationEnabled=!!i}get contentChanged(){return this._contentChanged}get stateChanged(){return this._stateChanged}get dirty(){return this._dirty}set dirty(e){const t=this._dirty;e!==t&&(this._dirty=e,this.triggerStateChange({name:"dirty",oldValue:t,newValue:e}))}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly)return;const t=this._readOnly;this._readOnly=e,this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get defaultKernelName(){return""}get defaultKernelLanguage(){return this._defaultLang}get collaborative(){return this._collaborationEnabled}toString(){return this.value.text}fromString(e){this.value.text=e}toJSON(){return JSON.parse(this.value.text||"null")}fromJSON(e){this.fromString(JSON.stringify(e))}initialize(){}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0),this.dirty=!0}_onStateChanged(e,t){t.sourceChange&&this.triggerContentChange(),t.stateChange&&t.stateChange.forEach((e=>{"dirty"===e.name?this.dirty=e.newValue:e.oldValue!==e.newValue&&this.triggerStateChange(Object.assign({newValue:void 0,oldValue:void 0},e))}))}}class f{constructor(e){this._isDisposed=!1,this._collaborative=null==e||e}get name(){return"text"}get contentType(){return"file"}get fileFormat(){return"text"}get collaborative(){return this._collaborative}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=!0}createNew(e,t,i,s){const a=s&&this.collaborative;return new y(e,t,a)}preferredLanguage(e){const t=p.AR.findByFileName(e);return t&&t.mode}}class F extends f{get name(){return"base64"}get contentType(){return"file"}get fileFormat(){return"base64"}}class w{constructor(e){this._isDisposed=!1,this._widgetCreated=new c.Signal(this),this._translator=e.translator||h.nullTranslator,this._name=e.name,this._readOnly=void 0!==e.readOnly&&e.readOnly,this._defaultFor=e.defaultFor?e.defaultFor.slice():[],this._defaultRendered=(e.defaultRendered||[]).slice(),this._fileTypes=e.fileTypes.slice(),this._modelName=e.modelName||"text",this._preferKernel=!!e.preferKernel,this._canStartKernel=!!e.canStartKernel,this._shutdownOnClose=!!e.shutdownOnClose,this._toolbarFactory=e.toolbarFactory}get widgetCreated(){return this._widgetCreated}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,c.Signal.clearData(this))}get readOnly(){return this._readOnly}get name(){return this._name}get fileTypes(){return this._fileTypes.slice()}get modelName(){return this._modelName}get defaultFor(){return this._defaultFor.slice()}get defaultRendered(){return this._defaultRendered.slice()}get preferKernel(){return this._preferKernel}get canStartKernel(){return this._canStartKernel}get translator(){return this._translator}get shutdownOnClose(){return this._shutdownOnClose}set shutdownOnClose(e){this._shutdownOnClose=e}createNew(e,t){var i;const a=this.createNewWidget(e,t);return(0,s.setToolbar)(a,null!==(i=this._toolbarFactory)&&void 0!==i?i:this.defaultToolbarFactory.bind(this)),this._widgetCreated.emit(a),a}defaultToolbarFactory(e){return[]}}const v="jp-mod-dirty";class b extends s.MainAreaWidget{constructor(e){e.reveal=Promise.all([e.reveal,e.context.ready]),super(e),this.context=e.context,this.context.pathChanged.connect(this._onPathChanged,this),this._onPathChanged(this.context,this.context.path),this.context.model.stateChanged.connect(this._onModelStateChanged,this),this.context.ready.then((()=>{this._handleDirtyState()})),this.title.changed.connect(this._onTitleChanged,this)}setFragment(e){}async _onTitleChanged(e){const t=this.title.label,i=this.context.path.split("/").pop();if(t!==i){if(t.length>0&&!/[\/\\:]/.test(t)){const e=this.context.path;if(await this.context.rename(t),this.context.path!==e)return}this.title.label=i}}_onPathChanged(e,t){this.title.label=a.PathExt.basename(e.localPath),this.isUntitled=!1}_onModelStateChanged(e,t){"dirty"===t.name&&this._handleDirtyState()}_handleDirtyState(){this.context.model.dirty&&!this.title.className.includes(v)?this.title.className+=` ${v}`:this.title.className=this.title.className.replace(v,"")}}var x,C=i(78695);class T extends _.Widget{constructor(e){super(),this._changeCallback=e=>{if(!e.data||!e.data[this.mimeType])return;const t=e.data[this.mimeType];"string"==typeof t?t!==this._context.model.toString()&&this._context.model.fromString(t):null==t||l.JSONExt.deepEqual(t,this._context.model.toJSON())||this._context.model.fromJSON(t)},this._fragment="",this._ready=new l.PromiseDelegate,this._isRendering=!1,this._renderRequested=!1,this.addClass("jp-MimeDocument"),this.translator=e.translator||h.nullTranslator,this._trans=this.translator.load("jupyterlab"),this.mimeType=e.mimeType,this._dataType=e.dataType||"string",this._context=e.context,this.renderer=e.renderer,(this.layout=new _.StackedLayout).addWidget(this.renderer),this._context.ready.then((()=>this._render())).then((()=>{this.node===document.activeElement&&C.MessageLoop.sendMessage(this.renderer,_.Widget.Msg.ActivateRequest),this._monitor=new a.ActivityMonitor({signal:this._context.model.contentChanged,timeout:e.renderTimeout}),this._monitor.activityStopped.connect(this.update,this),this._ready.resolve(void 0)})).catch((e=>{requestAnimationFrame((()=>{this.dispose()})),(0,s.showErrorMessage)(this._trans.__("Renderer Failure: %1",this._context.path),e)}))}[s.Printing.symbol](){return s.Printing.getPrintFunction(this.renderer)}get ready(){return this._ready.promise}setFragment(e){this._fragment=e,this.update()}dispose(){this.isDisposed||(this._monitor&&this._monitor.dispose(),this._monitor=null,super.dispose())}onUpdateRequest(e){this._context.isReady&&(this._render(),this._fragment="")}async _render(){if(this.isDisposed)return;if(this._isRendering)return void(this._renderRequested=!0);this._renderRequested=!1;const e=this._context,t=e.model,i={};"string"===this._dataType?i[this.mimeType]=t.toString():i[this.mimeType]=t.toJSON();const a=new r.MimeModel({data:i,callback:this._changeCallback,metadata:{fragment:this._fragment}});try{if(this._isRendering=!0,await this.renderer.renderModel(a),this._isRendering=!1,this._renderRequested)return this._render()}catch(t){requestAnimationFrame((()=>{this.dispose()})),(0,s.showErrorMessage)(this._trans.__("Renderer Failure: %1",e.path),t)}}}class O extends b{setFragment(e){this.content.setFragment(e)}}class D extends w{constructor(e){super(x.createRegistryOptions(e)),this._rendermime=e.rendermime,this._renderTimeout=e.renderTimeout||1e3,this._dataType=e.dataType||"string",this._fileType=e.primaryFileType,this._factory=e.factory}createNewWidget(e){var t,i;const s=this._fileType,a=(null==s?void 0:s.mimeTypes.length)?s.mimeTypes[0]:"text/plain",n=this._rendermime.clone({resolver:e.urlResolver});let o;o=this._factory&&this._factory.mimeTypes.includes(a)?this._factory.createRenderer({mimeType:a,resolver:n.resolver,sanitizer:n.sanitizer,linkHandler:n.linkHandler,latexTypesetter:n.latexTypesetter}):n.createRenderer(a);const r=new T({context:e,renderer:o,mimeType:a,renderTimeout:this._renderTimeout,dataType:this._dataType});return r.title.icon=null==s?void 0:s.icon,r.title.iconClass=null!==(t=null==s?void 0:s.iconClass)&&void 0!==t?t:"",r.title.iconLabel=null!==(i=null==s?void 0:s.iconLabel)&&void 0!==i?i:"",new O({content:r,context:e})}}!function(e){e.createRegistryOptions=function(e){return Object.assign(Object.assign({},e),{readOnly:!0})}}(x||(x={}));var S,M=i(24643),P=i(23203);class E{constructor(e={}){this._modelFactories=Object.create(null),this._widgetFactories=Object.create(null),this._defaultWidgetFactory="",this._defaultWidgetFactoryOverrides=Object.create(null),this._defaultWidgetFactories=Object.create(null),this._defaultRenderedWidgetFactories=Object.create(null),this._widgetFactoriesForFileType=Object.create(null),this._fileTypes=[],this._extenders=Object.create(null),this._changed=new c.Signal(this),this._isDisposed=!1;const t=e.textModelFactory;if(this.translator=e.translator||h.nullTranslator,t&&"text"!==t.name)throw new Error("Text model factory must have the name `text`");this._modelFactories.text=t||new f(!0),(e.initialFileTypes||E.getDefaultFileTypes(this.translator)).forEach((e=>{const t=Object.assign(Object.assign({},E.getFileTypeDefaults(this.translator)),e);this._fileTypes.push(t)}))}get changed(){return this._changed}get isDisposed(){return this._isDisposed}dispose(){if(!this.isDisposed){this._isDisposed=!0;for(const e in this._modelFactories)this._modelFactories[e].dispose();for(const e in this._widgetFactories)this._widgetFactories[e].dispose();for(const e in this._extenders)this._extenders[e].length=0;this._fileTypes.length=0,c.Signal.clearData(this)}}addWidgetFactory(e){const t=e.name.toLowerCase();if(!t||"default"===t)throw Error("Invalid factory name");if(this._widgetFactories[t])return console.warn(`Duplicate registered factory ${t}`),new d.DisposableDelegate(S.noOp);this._widgetFactories[t]=e;for(const i of e.defaultFor||[])-1!==e.fileTypes.indexOf(i)&&("*"===i?this._defaultWidgetFactory=t:this._defaultWidgetFactories[i]=t);for(const i of e.defaultRendered||[])-1!==e.fileTypes.indexOf(i)&&(this._defaultRenderedWidgetFactories[i]=t);for(const i of e.fileTypes)this._widgetFactoriesForFileType[i]||(this._widgetFactoriesForFileType[i]=[]),this._widgetFactoriesForFileType[i].push(t);return this._changed.emit({type:"widgetFactory",name:t,change:"added"}),new d.DisposableDelegate((()=>{delete this._widgetFactories[t],this._defaultWidgetFactory===t&&(this._defaultWidgetFactory="");for(const e of Object.keys(this._defaultWidgetFactories))this._defaultWidgetFactories[e]===t&&delete this._defaultWidgetFactories[e];for(const e of Object.keys(this._defaultRenderedWidgetFactories))this._defaultRenderedWidgetFactories[e]===t&&delete this._defaultRenderedWidgetFactories[e];for(const e of Object.keys(this._widgetFactoriesForFileType))P.ArrayExt.removeFirstOf(this._widgetFactoriesForFileType[e],t),0===this._widgetFactoriesForFileType[e].length&&delete this._widgetFactoriesForFileType[e];for(const e of Object.keys(this._defaultWidgetFactoryOverrides))this._defaultWidgetFactoryOverrides[e]===t&&delete this._defaultWidgetFactoryOverrides[e];this._changed.emit({type:"widgetFactory",name:t,change:"removed"})}))}addModelFactory(e){const t=e.name.toLowerCase();return this._modelFactories[t]?(console.warn(`Duplicate registered factory ${t}`),new d.DisposableDelegate(S.noOp)):(this._modelFactories[t]=e,this._changed.emit({type:"modelFactory",name:t,change:"added"}),new d.DisposableDelegate((()=>{delete this._modelFactories[t],this._changed.emit({type:"modelFactory",name:t,change:"removed"})})))}addWidgetExtension(e,t){(e=e.toLowerCase())in this._extenders||(this._extenders[e]=[]);const i=this._extenders[e];return-1!==P.ArrayExt.firstIndexOf(i,t)?(console.warn(`Duplicate registered extension for ${e}`),new d.DisposableDelegate(S.noOp)):(this._extenders[e].push(t),this._changed.emit({type:"widgetExtension",name:e,change:"added"}),new d.DisposableDelegate((()=>{P.ArrayExt.removeFirstOf(this._extenders[e],t),this._changed.emit({type:"widgetExtension",name:e,change:"removed"})})))}addFileType(e,t){const i=Object.assign(Object.assign(Object.assign({},E.getFileTypeDefaults(this.translator)),e),!(e.icon||e.iconClass)&&{icon:M.fileIcon});if(this._fileTypes.push(i),t){const e=i.name.toLowerCase();t.map((e=>e.toLowerCase())).forEach((t=>{this._widgetFactoriesForFileType[e]||(this._widgetFactoriesForFileType[e]=[]),this._widgetFactoriesForFileType[e].includes(t)||this._widgetFactoriesForFileType[e].push(t)})),this._defaultWidgetFactories[e]||(this._defaultWidgetFactories[e]=this._widgetFactoriesForFileType[e][0])}return this._changed.emit({type:"fileType",name:i.name,change:"added"}),new d.DisposableDelegate((()=>{if(P.ArrayExt.removeFirstOf(this._fileTypes,i),t){const e=i.name.toLowerCase();for(const i of t.map((e=>e.toLowerCase())))P.ArrayExt.removeFirstOf(this._widgetFactoriesForFileType[e],i);this._defaultWidgetFactories[e]===t[0].toLowerCase()&&delete this._defaultWidgetFactories[e]}this._changed.emit({type:"fileType",name:e.name,change:"removed"})}))}preferredWidgetFactories(e){const t=new Set,i=this.getFileTypesForPath(a.PathExt.basename(e));i.forEach((e=>{e.name in this._defaultWidgetFactoryOverrides&&t.add(this._defaultWidgetFactoryOverrides[e.name])})),i.forEach((e=>{e.name in this._defaultWidgetFactories&&t.add(this._defaultWidgetFactories[e.name])})),i.forEach((e=>{e.name in this._defaultRenderedWidgetFactories&&t.add(this._defaultRenderedWidgetFactories[e.name])})),this._defaultWidgetFactory&&t.add(this._defaultWidgetFactory),i.forEach((e=>{e.name in this._widgetFactoriesForFileType&&(0,P.each)(this._widgetFactoriesForFileType[e.name],(e=>{t.add(e)}))})),"*"in this._widgetFactoriesForFileType&&(0,P.each)(this._widgetFactoriesForFileType["*"],(e=>{t.add(e)}));const s=[];return t.forEach((e=>{const t=this._widgetFactories[e];t&&(t.modelName||"text")in this._modelFactories&&s.push(t)})),s}defaultRenderedWidgetFactory(e){const t=this.getFileTypesForPath(a.PathExt.basename(e)).map((e=>e.name));for(const e in t)if(e in this._defaultWidgetFactoryOverrides)return this._widgetFactories[this._defaultWidgetFactoryOverrides[e]];for(const e in t)if(e in this._defaultRenderedWidgetFactories)return this._widgetFactories[this._defaultRenderedWidgetFactories[e]];return this.defaultWidgetFactory(e)}defaultWidgetFactory(e){return e?this.preferredWidgetFactories(e)[0]:this._widgetFactories[this._defaultWidgetFactory]}setDefaultWidgetFactory(e,t){if(e=e.toLowerCase(),!this.getFileType(e))throw Error(`Cannot find file type ${e}`);if(!t)return void(this._defaultWidgetFactoryOverrides[e]&&delete this._defaultWidgetFactoryOverrides[e]);if(!this.getWidgetFactory(t))throw Error(`Cannot find widget factory ${t}`);t=t.toLowerCase();const i=this._widgetFactoriesForFileType[e];if(!(t===this._defaultWidgetFactory||i&&i.includes(t)))throw Error(`Factory ${t} cannot view file type ${e}`);this._defaultWidgetFactoryOverrides[e]=t}widgetFactories(){return(0,P.map)(Object.keys(this._widgetFactories),(e=>this._widgetFactories[e]))}modelFactories(){return(0,P.map)(Object.keys(this._modelFactories),(e=>this._modelFactories[e]))}widgetExtensions(e){return(e=e.toLowerCase())in this._extenders?new P.ArrayIterator(this._extenders[e]):(0,P.empty)()}fileTypes(){return new P.ArrayIterator(this._fileTypes)}getWidgetFactory(e){return this._widgetFactories[e.toLowerCase()]}getModelFactory(e){return this._modelFactories[e.toLowerCase()]}getFileType(e){return e=e.toLowerCase(),(0,P.find)(this._fileTypes,(t=>t.name.toLowerCase()===e))}getKernelPreference(e,t,i){t=t.toLowerCase();const s=this._widgetFactories[t];if(!s)return;const n=this.getModelFactory(s.modelName||"text");if(!n)return;const o=n.preferredLanguage(a.PathExt.basename(e)),r=i&&i.name;return{id:i&&i.id,name:r,language:o,shouldStart:s.preferKernel,canStart:s.canStartKernel,shutdownOnDispose:s.shutdownOnClose}}getFileTypeForModel(e){switch(e.type){case"directory":return(0,P.find)(this._fileTypes,(e=>"directory"===e.contentType))||E.getDefaultDirectoryFileType(this.translator);case"notebook":return(0,P.find)(this._fileTypes,(e=>"notebook"===e.contentType))||E.getDefaultNotebookFileType(this.translator);default:if(e.name||e.path){const t=e.name||a.PathExt.basename(e.path),i=this.getFileTypesForPath(t);if(i.length>0)return i[0]}return this.getFileType("text")||E.getDefaultTextFileType(this.translator)}}getFileTypesForPath(e){const t=[],i=a.PathExt.basename(e);let s=(0,P.find)(this._fileTypes,(e=>!(!e.pattern||null===i.match(e.pattern))));s&&t.push(s);let n=S.extname(i);for(;n.length>1;){const e=this._fileTypes.filter((e=>e.extensions.map((e=>e.toLowerCase())).includes(n)));t.push(...e),n="."+n.split(".").slice(2).join(".")}return t}}!function(e){function t(e){return{name:"default",displayName:(null==(e=e||h.nullTranslator)?void 0:e.load("jupyterlab")).__("default"),extensions:[],mimeTypes:[],contentType:"file",fileFormat:"text"}}function i(e){const i=null==(e=e||h.nullTranslator)?void 0:e.load("jupyterlab"),s=t(e);return Object.assign(Object.assign({},s),{name:"text",displayName:i.__("Text"),mimeTypes:["text/plain"],extensions:[".txt"],icon:M.fileIcon})}function s(e){const i=null==(e=e||h.nullTranslator)?void 0:e.load("jupyterlab");return Object.assign(Object.assign({},t(e)),{name:"notebook",displayName:i.__("Notebook"),mimeTypes:["application/x-ipynb+json"],extensions:[".ipynb"],contentType:"notebook",fileFormat:"json",icon:M.notebookIcon})}function a(e){const i=null==(e=e||h.nullTranslator)?void 0:e.load("jupyterlab");return Object.assign(Object.assign({},t(e)),{name:"directory",displayName:i.__("Directory"),extensions:[],mimeTypes:["text/directory"],contentType:"directory",icon:M.folderIcon})}e.getFileTypeDefaults=t,e.getDefaultTextFileType=i,e.getDefaultNotebookFileType=s,e.getDefaultDirectoryFileType=a,e.getDefaultFileTypes=function(e){const t=null==(e=e||h.nullTranslator)?void 0:e.load("jupyterlab");return[i(e),s(e),a(e),{name:"markdown",displayName:t.__("Markdown File"),extensions:[".md"],mimeTypes:["text/markdown"],icon:M.markdownIcon},{name:"PDF",displayName:t.__("PDF File"),extensions:[".pdf"],mimeTypes:["application/pdf"],icon:M.pdfIcon},{name:"python",displayName:t.__("Python File"),extensions:[".py"],mimeTypes:["text/x-python"],icon:M.pythonIcon},{name:"json",displayName:t.__("JSON File"),extensions:[".json"],mimeTypes:["application/json"],icon:M.jsonIcon},{name:"julia",displayName:t.__("Julia File"),extensions:[".jl"],mimeTypes:["text/x-julia"],icon:M.juliaIcon},{name:"csv",displayName:t.__("CSV File"),extensions:[".csv"],mimeTypes:["text/csv"],icon:M.spreadsheetIcon},{name:"tsv",displayName:t.__("TSV File"),extensions:[".tsv"],mimeTypes:["text/csv"],icon:M.spreadsheetIcon},{name:"r",displayName:t.__("R File"),mimeTypes:["text/x-rsrc"],extensions:[".R"],icon:M.rKernelIcon},{name:"yaml",displayName:t.__("YAML File"),mimeTypes:["text/x-yaml","text/yaml"],extensions:[".yaml",".yml"],icon:M.yamlIcon},{name:"svg",displayName:t.__("Image"),mimeTypes:["image/svg+xml"],extensions:[".svg"],icon:M.imageIcon,fileFormat:"base64"},{name:"tiff",displayName:t.__("Image"),mimeTypes:["image/tiff"],extensions:[".tif",".tiff"],icon:M.imageIcon,fileFormat:"base64"},{name:"jpeg",displayName:t.__("Image"),mimeTypes:["image/jpeg"],extensions:[".jpg",".jpeg"],icon:M.imageIcon,fileFormat:"base64"},{name:"gif",displayName:t.__("Image"),mimeTypes:["image/gif"],extensions:[".gif"],icon:M.imageIcon,fileFormat:"base64"},{name:"png",displayName:t.__("Image"),mimeTypes:["image/png"],extensions:[".png"],icon:M.imageIcon,fileFormat:"base64"},{name:"bmp",displayName:t.__("Image"),mimeTypes:["image/bmp"],extensions:[".bmp"],icon:M.imageIcon,fileFormat:"base64"},{name:"webp",displayName:t.__("Image"),mimeTypes:["image/webp"],extensions:[".webp"],icon:M.imageIcon,fileFormat:"base64"}]}}(E||(E={})),function(e){e.extname=function(e){const t=a.PathExt.basename(e).split(".");return t.shift(),("."+t.join(".")).toLowerCase()},e.noOp=function(){}}(S||(S={}))}}]);